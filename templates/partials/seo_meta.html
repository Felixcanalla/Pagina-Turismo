{% load wagtailimages_tags static %}

{% with base_url=request.scheme|add:'://'|add:request.get_host %}
  <title>{{ page.seo_title|default:page.title|default:"Guía de Viajes" }}</title>

  {# Description #}
  {% if page.search_description %}
    <meta name="description" content="{{ page.search_description|striptags|truncatechars:160 }}">
  {% elif page.intro %}
    <meta name="description" content="{{ page.intro|striptags|truncatechars:160 }}">
  {% else %}
    <meta name="description" content="Guías, destinos y consejos de viaje.">
  {% endif %}

  {# Canonical #}
  {% if page.full_url %}
    <link rel="canonical" href="{{ page.full_url }}">
  {% else %}
    <link rel="canonical" href="{{ base_url }}{{ request.path }}">
  {% endif %}

  {# Open Graph #}
  <meta property="og:site_name" content="Guía de Viajes">
  <meta property="og:title" content="{{ page.seo_title|default:page.title|default:'Guía de Viajes' }}">
  {% if page.search_description %}
    <meta property="og:description" content="{{ page.search_description|striptags|truncatechars:200 }}">
  {% elif page.intro %}
    <meta property="og:description" content="{{ page.intro|striptags|truncatechars:200 }}">
  {% else %}
    <meta property="og:description" content="Guías, destinos y consejos de viaje.">
  {% endif %}
  <meta property="og:url" content="{% if page.full_url %}{{ page.full_url }}{% else %}{{ base_url }}{{ request.path }}{% endif %}">

  {# og:type (simple y seguro) #}
  {% if page.cover_image or page.hero_image %}
    <meta property="og:type" content="article">
  {% else %}
    <meta property="og:type" content="website">
  {% endif %}

  {# OG image #}
  {% if page.cover_image %}
    {% image page.cover_image fill-1200x630 as ogimg %}
    <meta property="og:image" content="{{ ogimg.url }}">
  {% elif page.hero_image %}
    {% image page.hero_image fill-1200x630 as ogimg %}
    <meta property="og:image" content="{{ ogimg.url }}">
  {% else %}
    <meta property="og:image" content="{{ base_url }}{% static 'img/og-default.jpg' %}">
  {% endif %}

  {# Twitter #}
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="{{ page.seo_title|default:page.title|default:'Guía de Viajes' }}">
  {% if page.search_description %}
    <meta name="twitter:description" content="{{ page.search_description|striptags|truncatechars:200 }}">
  {% elif page.intro %}
    <meta name="twitter:description" content="{{ page.intro|striptags|truncatechars:200 }}">
  {% else %}
    <meta name="twitter:description" content="Guías, destinos y consejos de viaje.">
  {% endif %}
  {% if page.cover_image %}
    {% image page.cover_image fill-1200x630 as twimg %}
    <meta name="twitter:image" content="{{ twimg.url }}">
  {% elif page.hero_image %}
    {% image page.hero_image fill-1200x630 as twimg %}
    <meta name="twitter:image" content="{{ twimg.url }}">
  {% else %}
    <meta name="twitter:image" content="{{ base_url }}{% static 'img/og-default.jpg' %}">
  {% endif %}
{% endwith %}
