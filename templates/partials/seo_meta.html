{% load wagtailimages_tags static %}

{% with
  page_url=page.full_url|default:request.build_absolute_uri
  site_name="Destinos Posibles"
  base=request.scheme|add:"://"|add:request.get_host
  page_title=page.seo_title|default:page.title|default:site_name
%}

  {# --- TITLE --- #}
  <title>{{ page_title }}</title>

  {# --- DESCRIPTION (SEO/OG/Twitter desde una sola fuente) --- #}
  {% if page.seo_description %}
    {% with desc=page.seo_description|striptags|truncatechars:160 %}
      <meta name="description" content="{{ desc }}">
      <meta property="og:description" content="{{ desc|truncatechars:200 }}">
      <meta name="twitter:description" content="{{ desc|truncatechars:200 }}">
    {% endwith %}
  {% elif page.search_description %}
    {% with desc=page.search_description|striptags|truncatechars:160 %}
      <meta name="description" content="{{ desc }}">
      <meta property="og:description" content="{{ desc|truncatechars:200 }}">
      <meta name="twitter:description" content="{{ desc|truncatechars:200 }}">
    {% endwith %}
  {% elif page.intro %}
    {% with desc=page.intro|striptags|truncatechars:160 %}
      <meta name="description" content="{{ desc }}">
      <meta property="og:description" content="{{ desc|truncatechars:200 }}">
      <meta name="twitter:description" content="{{ desc|truncatechars:200 }}">
    {% endwith %}
  {% else %}
    {% with desc="Gu√≠as, destinos y consejos de viaje." %}
      <meta name="description" content="{{ desc }}">
      <meta property="og:description" content="{{ desc }}">
      <meta name="twitter:description" content="{{ desc }}">
    {% endwith %}
  {% endif %}

  {# --- CANONICAL --- #}
  <link rel="canonical" href="{{ page_url }}">

  {# --- OPEN GRAPH --- #}
  <meta property="og:site_name" content="{{ site_name }}">
  <meta property="og:title" content="{{ page_title }}">
  <meta property="og:url" content="{{ page_url }}">
  <meta property="og:locale" content="es_AR">

  {# Tipo OG (tolerante): ArticuloPage => article #}
{% if page.content_type.model == "articulopage" %}
    <meta property="og:type" content="article">
  {% else %}
    <meta property="og:type" content="website">
  {% endif %}

  {# --- SHARE IMAGE: SIEMPRE ABSOLUTA --- #}
  {% if page.cover_image %}
    {% image page.cover_image fill-1200x630 as shareimg %}
    <meta property="og:image" content="{{ base }}{{ shareimg.url }}">
    <meta name="twitter:image" content="{{ base }}{{ shareimg.url }}">
  {% elif page.hero_image %}
    {% image page.hero_image fill-1200x630 as shareimg %}
    <meta property="og:image" content="{{ base }}{{ shareimg.url }}">
    <meta name="twitter:image" content="{{ base }}{{ shareimg.url }}">
  {% else %}
    <meta property="og:image" content="{{ base }}{% static 'img/og-default.jpg' %}">
    <meta name="twitter:image" content="{{ base }}{% static 'img/og-default.jpg' %}">
  {% endif %}

  {# --- TWITTER --- #}
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="{{ page_title }}">
  <meta name="twitter:url" content="{{ page_url }}">

  {# --- ROBOTS: evita indexar staging en onrender --- #}
  {% if request.get_host and "onrender.com" in request.get_host %}
    <meta name="robots" content="noindex,follow">
  {% else %}
    <meta name="robots" content="index,follow">
  {% endif %}

{% endwith %}