{% with canonical=page.full_url|default:request.build_absolute_uri %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Inicio",
      "item": "{{ request.scheme }}://{{ request.get_host }}/"
    }{% if breadcrumb_ancestors %}{% for crumb in breadcrumb_ancestors %},
    {
      "@type": "ListItem",
      "position": {{ forloop.counter|add:1 }},
      "name": "{{ crumb.title|escapejs }}",
      "item": "{{ crumb.full_url }}"
    }{% endfor %}{% endif %},
    {
      "@type": "ListItem",
      "position": {% if breadcrumb_ancestors %}{{ breadcrumb_ancestors|length|add:2 }}{% else %}2{% endif %},
      "name": "{{ page.title|escapejs }}",
      "item": "{{ canonical }}"
    }
  ]
}
</script>
{% endwith %}
