{# templates/partials/jsonld_breadcrumbs.html #}
{% with
  canonical=page.full_url|default:request.build_absolute_uri
  base=request.scheme|add:"://"|add:request.get_host
%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Inicio",
      "item": "{{ base }}/"
    }{% if breadcrumb_ancestors %}
      {% for crumb in breadcrumb_ancestors %}
        ,
        {
          "@type": "ListItem",
          "position": {{ forloop.counter|add:1 }},
          "name": "{{ crumb.title|escapejs }}",
          "item": "{{ base }}{{ crumb.url }}"
        }
      {% endfor %}
    {% endif %}
    ,
    {
      "@type": "ListItem",
      "position": {% if breadcrumb_ancestors %}{{ breadcrumb_ancestors|length|add:2 }}{% else %}2{% endif %},
      "name": "{{ page.title|escapejs }}",
      "item": "{{ canonical }}"
    }
  ]
}
</script>
{% endwith %}