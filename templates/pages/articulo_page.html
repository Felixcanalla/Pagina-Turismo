{% extends "base.html" %}
{% load wagtailimages_tags wagtailcore_tags %}

{% block extra_head %}
  {% include "partials/jsonld_breadcrumbs.html" %}
  {% include "partials/jsonld_article.html" %}
  {# {% include "partials/jsonld_faq.html" %} #}
{% endblock %}

{% block content %}
<article class="container">

  <header class="hero hero--stack {% if not page.cover_image %}hero--noimg{% endif %}">
    <div class="hero-stack">

      <nav class="breadcrumbs" aria-label="Breadcrumb">
        <ol>
          <li><a href="/">Inicio</a></li>
          {% if breadcrumb_ancestors %}
            {% for ancestor in breadcrumb_ancestors %}
              {% if ancestor.url != "/" %}
                <li><a href="{{ ancestor.url }}">{{ ancestor.title }}</a></li>
              {% endif %}
            {% endfor %}
          {% endif %}
          <li aria-current="page">{{ page.title }}</li>
        </ol>
      </nav>

      <h1>{{ page.title }}</h1>

      {% if page.intro %}
        <p class="muted">{{ page.intro }}</p>
      {% elif page.search_description %}
        <p class="muted">{{ page.search_description }}</p>
      {% endif %}
    </div>

    {% if page.cover_image %}
      {% image page.cover_image fill-1600x700 class="hero-img" %}
    {% endif %}
  </header>

  <div class="post__content">
    {% if toc %}
      <nav class="toc" aria-label="Tabla de contenidos">
        <h3 class="toc__title">Contenido</h3>
        <ul class="toc__list">
          {% for item in toc %}
            <li class="toc__item">
              <a class="toc__link" href="#{{ item.anchor|escape }}">{{ item.title|escape }}</a>
            </li>
          {% endfor %}
        </ul>
      </nav>
    {% endif %}

    <div class="content post__body">
      {% if body_html %}
        {{ body_html|safe }}
      {% elif page.body %}
        {% for block in page.body %}
          {% include_block block %}
        {% endfor %}
      {% else %}
        <p class="muted">Este artículo todavía no tiene contenido publicado.</p>
      {% endif %}
    </div>
  </div>

  {# ✅ Destinos relacionados (Orderable) #}
  {% with related=page.destinos_relacionados.all %}
    {% if related.count %}
      <section class="related">
        <h2>Destinos relacionados</h2>
        <ul>
          {% for rel in related %}
            {% if rel.destino %}
              <li><a href="{{ rel.destino.url }}">{{ rel.destino.title }}</a></li>
            {% endif %}
          {% endfor %}
        </ul>
      </section>
    {% endif %}
  {% endwith %}

</article>
{% endblock %}